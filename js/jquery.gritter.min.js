(function($){$.gritter={};$.gritter.options={text:'',title:'',sticky:false,image:undefined,position:'tr',class_name:'',fade_out:true,fade_in_speed:'medium',fade_out_speed:1000,time:6000,collapse_speed:300,delay_collapse:true,maximum:-1,overflow_collapse_speed:250,overflow_fade_out_speed:600,overflow_delay_collapse:false,overflow_kills_sticky:false,before_open:function(){},after_open:function(){},before_close:function(){},after_close:function(){}};$.gritter.add=function(params){try{return $.gritter._implementation.add(params||{});}catch(e){var err='Gritter Error: '+e;(typeof(console)!='undefined'&&console.error)?console.error(err,params):alert(err);}};$.gritter.remove=function(id,params){$.gritter._implementation.removeSpecific(id,params||{});};$.gritter.removeAll=function(params){$.gritter._implementation.stop(params||{});};$.gritter._implementation={_custom_timer:0,_item_count:0,_is_setup:0,_tpl_close:'<div class="gritter-close"></div>',_tpl_title:'<span class="gritter-title">[[title]]</span>',_tpl_item:'<div id="gritter-item-[[number]]" class="gritter-item-wrapper [[item_class]]" style="display:none"><div class="gritter-top"></div><div class="gritter-item">[[close]][[image]]<div class="[[class_name]]">[[title]]<p>[[text]]</p></div><div style="clear:both"></div></div><div class="gritter-bottom"></div></div>',_tpl_wrap:'<div class="gritter-notice-wrapper"></div>',add:function(params){var _self=this;if(typeof(params)=='string'){params={text:params};}for(i in params){if($.trim(params[i].toString()).length==0){delete params[i];}}params=$.extend({},$.gritter.options,params);if(params.text===null){throw'You must supply "text" parameter.';}this._verifyWrapper(params['position']);var number=++this._item_count,tmp=this._tpl_item;$(['before_open','after_open','before_close','after_close']).each(function(i,val){_self['_'+val+'_'+number]=($.isFunction(params[val]))?params[val]:function(){}});var image_str=params['image']!=undefined?'<img src="'+params['image']+'" class="gritter-image" />':'',class_name=params['image']!=undefined?'gritter-with-image':'gritter-without-image';if(params.title){params.title=this._str_replace('[[title]]',params.title,this._tpl_title);}else{params.title='';}tmp=this._str_replace(['[[title]]','[[text]]','[[close]]','[[image]]','[[number]]','[[class_name]]','[[item_class]]'],[params.title,params.text,this._tpl_close,image_str,this._item_count,class_name,params.class_name],tmp);if(this['_before_open_'+number]()===false){return false;}var pos=params['position'];this._isUpper(pos)?$('.gritter-notice-wrapper.'+params['position']).append(tmp):$('.gritter-notice-wrapper.'+params['position']).prepend(tmp);var item=$('#gritter-item-'+this._item_count).addClass('gritter-static');item.fadeIn(params['fade_in_speed'],function(){_self['_after_open_'+number]($(this));});if(!params.sticky){this._setFadeTimer(item,number,params);}else{item.addClass('sticky');}$(item).bind('mouseenter mouseleave',function(event){if(event.type=='mouseenter'){if(!params.sticky){_self._restoreItemIfFading($(this),number);}}else{if(!params.sticky){_self._setFadeTimer($(this),number,params);}}_self._hoverState($(this),event.type);});$(item).find('.gritter-close').click(function(){_self.removeSpecific(number,{},null,true);});this._checkMax(params);return number;},count:function(position){return $('.gritter-notice-wrapper.'+position).children().length;},stop:function(params){var before_close=($.isFunction(params.before_close))?params.before_close:function(){};var after_close=($.isFunction(params.after_close))?params.after_close:function(){};var wraps=$('.gritter-notice-wrapper');console.log(wraps);before_close(wraps);wraps.fadeOut(function(){$(this).remove();after_close();});},removeSpecific:function(unique_id,params,e,unbind_events){if(!e){if(!unique_id){throw'removeSpecific; Either unique_id or e must be specified.';}var e=$('#gritter-item-'+unique_id);}this._fade(e,unique_id||this._getIdFromElement(e),params||{},unbind_events);},_isUpper:function(position){return position=='tr'||position=='tl';},_checkMax:function(params){var staticItems=params.overflow_kills_sticky?$('.gritter-notice-wrapper.'+params['position']+' .gritter-static'):$('.gritter-notice-wrapper.'+params['position']+' .gritter-static:not(.sticky)');while(params.maximum>0&&staticItems.length>params.maximum){var p=$.extend({},params,{speed:params.overflow_fade_out_speed,collapse_speed:params.overflow_collapse_speed,delay_collapse:params.overflow_delay_collapse});var target=this._isUpper(params['position'])?staticItems.first():staticItems.last();this.removeSpecific(null,p,target);var staticItems=params.overflow_kills_sticky?$('.gritter-notice-wrapper.'+params['position']+' .gritter-static'):$('.gritter-notice-wrapper.'+params['position']+' .gritter-static:not(.sticky)');}},_countRemoveWrapper:function(unique_id,e,position,manual_close){e.remove();this['_after_close_'+unique_id](e,manual_close);if(this.count(position)==0){$('.gritter-notice-wrapper.'+position).remove();}},_fade:function(e,unique_id,params,unbind_events){var _self=this;this['_before_close_'+unique_id](e,unbind_events);if(unbind_events){e.unbind('mouseenter mouseleave');}e.removeClass('gritter-static');if(params.fade_out){if(params.delay_collapse){e.animate({opacity:0},params.fade_out_speed,function(){e.animate({height:0},params.collapse_speed,function(){_self._countRemoveWrapper(unique_id,e,params['position'],unbind_events);})});}else{e.animate({opacity:0,height:0},{duration:params.collapse_speed,complete:function(){_self._countRemoveWrapper(unique_id,e,params['position'],unbind_events);},queue:false});}}else{this._countRemoveWrapper(unique_id,e,params['position']);}},_hoverState:function(e,type){if(type=='mouseenter'){e.addClass('hover');e.find('.gritter-close').show();}else{e.removeClass('hover');e.find('.gritter-close').hide();}},_getIdFromElement:function(e){var m=/gritter-item-([\d]+)/.exec(e.attr('id'));return m.length>1?parseInt(m[1]):null;},_restoreItemIfFading:function(e,unique_id){clearTimeout(this['_int_id_'+unique_id]);e.stop().css({opacity:'',height:''}).addClass('gritter-static');},_setFadeTimer:function(e,unique_id,params){var _self=this;this['_int_id_'+unique_id]=setTimeout(function(){_self._fade(e,unique_id,params);},params['time']);},_str_replace:function(find,change,subject,count){var i=0,j=0,temp='',repl='',sl=0,fl=0,f=[].concat(find),r=[].concat(change),s=subject,ra=r instanceof Array,sa=s instanceof Array;s=[].concat(s);if(count){this.window[count]=0;}for(i=0,sl=s.length;i<sl;i++){if(s[i]===''){continue;}for(j=0,fl=f.length;j<fl;j++){temp=s[i]+'';repl=ra?(r[j]!==undefined?r[j]:''):r[0];s[i]=(temp).split(f[j]).join(repl);if(count&&s[i]!==temp){this.window[count]+=(temp.length-s[i].length)/f[j].length;}}}return sa?s:s[0];},_verifyWrapper:function(position){if($('.gritter-notice-wrapper.'+position).length==0){$('body').append($(this._tpl_wrap).addClass(position));}}}})(jQuery);
