(function(e){e.gritter={};e.gritter.options={text:"",title:"",sticky:false,image:undefined,position:"tr",class_name:"",fade_out:true,fade_in_speed:"medium",fade_out_speed:1e3,time:6e3,collapse_speed:300,delay_collapse:true,maximum:-1,overflow_collapse_speed:250,overflow_fade_out_speed:600,overflow_delay_collapse:false,overflow_kills_sticky:false,before_open:function(){},after_open:function(){},before_close:function(){},after_close:function(){}};e.gritter.add=function(t){try{return e.gritter._implementation.add(t||{})}catch(n){var r="Gritter Error: "+n;typeof console!="undefined"&&console.error?console.error(r,t):alert(r)}};e.gritter.remove=function(t,n){e.gritter._implementation.removeSpecific(t,n||{})};e.gritter.removeAll=function(t){e.gritter._implementation.stop(t||{})};e.gritter._implementation={_custom_timer:0,_item_count:0,_is_setup:0,_tpl_close:'<div class="gritter-close"></div>',_tpl_title:'<span class="gritter-title">[[title]]</span>',_tpl_item:'<div id="gritter-item-[[number]]" class="gritter-item-wrapper [[item_class]]" style="display:none"><div class="gritter-top"></div><div class="gritter-item">[[close]][[image]]<div class="[[class_name]]">[[title]]<p>[[text]]</p></div><div style="clear:both"></div></div><div class="gritter-bottom"></div></div>',_tpl_wrap:'<div id="gritter-notice-wrapper"></div>',add:function(t){var n=this;if(typeof t=="string"){t={text:t}}for(i in t){if(e.trim(t[i].toString()).length==0){delete t[i]}}t=e.extend({},e.gritter.options,t);if(t.text===null){throw'You must supply "text" parameter.'}this._verifyWrapper(t["position"]);var r=++this._item_count,s=this._tpl_item;e(["before_open","after_open","before_close","after_close"]).each(function(i,s){n["_"+s+"_"+r]=e.isFunction(t[s])?t[s]:function(){}});var o=t["image"]!=undefined?'<img src="'+t["image"]+'" class="gritter-image" />':"",u=t["image"]!=undefined?"gritter-with-image":"gritter-without-image";if(t.title){t.title=this._str_replace("[[title]]",t.title,this._tpl_title)}else{t.title=""}s=this._str_replace(["[[title]]","[[text]]","[[close]]","[[image]]","[[number]]","[[class_name]]","[[item_class]]"],[t.title,t.text,this._tpl_close,o,this._item_count,u,t.class_name],s);if(this["_before_open_"+r]()===false){return false}var a=t["position"];this._isUpper(a)?e("#gritter-notice-wrapper."+t["position"]).append(s):e("#gritter-notice-wrapper."+t["position"]).prepend(s);var f=e("#gritter-item-"+this._item_count).addClass("gritter-static");f.fadeIn(t["fade_in_speed"],function(){n["_after_open_"+r](e(this))});if(!t.sticky){this._setFadeTimer(f,r,t)}else{f.addClass("sticky")}e(f).bind("mouseenter mouseleave",function(i){if(i.type=="mouseenter"){if(!t.sticky){n._restoreItemIfFading(e(this),r)}}else{if(!t.sticky){n._setFadeTimer(e(this),r,t)}}n._hoverState(e(this),i.type)});e(f).find(".gritter-close").click(function(){n.removeSpecific(r,{},null,true)});this._checkMax(t);return r},count:function(t){return e("#gritter-notice-wrapper."+t).children().length},stop:function(t){var n=e.isFunction(t.before_close)?t.before_close:function(){};var r=e.isFunction(t.after_close)?t.after_close:function(){};var i=e("#gritter-notice-wrapper."+t["position"]);n(i);i.fadeOut(function(){e(this).remove();r()})},removeSpecific:function(t,n,r,i){if(!r){if(!t){throw"removeSpecific; Either unique_id or e must be specified."}var r=e("#gritter-item-"+t)}this._fade(r,t||this._getIdFromElement(r),n||{},i)},_isUpper:function(e){return e=="tr"||e=="tl"},_checkMax:function(t){var n=t.overflow_kills_sticky?e("#gritter-notice-wrapper."+t["position"]+" .gritter-static"):e("#gritter-notice-wrapper."+t["position"]+" .gritter-static:not(.sticky)");while(t.maximum>0&&n.length>t.maximum){var r=e.extend({},t,{speed:t.overflow_fade_out_speed,collapse_speed:t.overflow_collapse_speed,delay_collapse:t.overflow_delay_collapse});var i=this._isUpper(t["position"])?n.first():n.last();this.removeSpecific(null,r,i);var n=t.overflow_kills_sticky?e("#gritter-notice-wrapper."+t["position"]+" .gritter-static"):e("#gritter-notice-wrapper."+t["position"]+" .gritter-static:not(.sticky)")}},_countRemoveWrapper:function(t,n,r,i){n.remove();this["_after_close_"+t](n,i);if(this.count(r)==0){e("#gritter-notice-wrapper."+r).remove()}},_fade:function(e,t,n,r){var i=this;this["_before_close_"+t](e,r);if(r){e.unbind("mouseenter mouseleave")}e.removeClass("gritter-static");if(n.fade_out){if(n.delay_collapse){e.animate({opacity:0},n.fade_out_speed,function(){e.animate({height:0},n.collapse_speed,function(){i._countRemoveWrapper(t,e,n["position"],r)})})}else{e.animate({opacity:0,height:0},{duration:n.collapse_speed,complete:function(){i._countRemoveWrapper(t,e,n["position"],r)},queue:false})}}else{this._countRemoveWrapper(t,e,n["position"])}},_hoverState:function(e,t){if(t=="mouseenter"){e.addClass("hover");e.find(".gritter-close").show()}else{e.removeClass("hover");e.find(".gritter-close").hide()}},_getIdFromElement:function(e){var t=/gritter-item-([\d]+)/.exec(e.attr("id"));return t.length>1?parseInt(t[1]):null},_restoreItemIfFading:function(e,t){clearTimeout(this["_int_id_"+t]);e.stop().css({opacity:"",height:""}).addClass("gritter-static")},_setFadeTimer:function(e,t,n){var r=this;this["_int_id_"+t]=setTimeout(function(){r._fade(e,t,n)},n["time"])},_str_replace:function(e,t,n,r){var i=0,s=0,o="",u="",a=0,f=0,l=[].concat(e),c=[].concat(t),h=n,p=c instanceof Array,d=h instanceof Array;h=[].concat(h);if(r){this.window[r]=0}for(i=0,a=h.length;i<a;i++){if(h[i]===""){continue}for(s=0,f=l.length;s<f;s++){o=h[i]+"";u=p?c[s]!==undefined?c[s]:"":c[0];h[i]=o.split(l[s]).join(u);if(r&&h[i]!==o){this.window[r]+=(o.length-h[i].length)/l[s].length}}}return d?h:h[0]},_verifyWrapper:function(t){if(e("#gritter-notice-wrapper."+t).length==0){e("body").append(e(this._tpl_wrap).addClass(t))}}}})(jQuery)
